<#import "../layout/defaultLayout.ftl.html" as layout>
<@layout.myLayout "Project :: New">
	<div class="container">
		<div class="col-lg-9">
			<h3>${i18n('project.new')}</h3>
			<form id="projectForm" class="form-group form-error-label" action="/project" method="post">
			<@authenticityForm/>
				<div class="contact-form">
					<label>${i18n('project.title')}</label><span class="required">*</span><h5 
					class="contact-us-form-error">${(flash.invalidName!)}</h5>
					<input type="text" id="title" name="title" class="form-control" 
					placeholder="${i18n('project.title.placeholder')}">
				</div>
				<div class="contact-form">
					<label>${i18n('project.category')}</label>
					<select name="projectCategory">
						<option value="Project" selected="selected">Project</option>
						<option value="News & Events">News & Events</option>
					</select>
				</div>
				<div class="contact-form">
					<label>${i18n('project.description')}</label><span class="required">*</span><h5 
					class="contact-us-form-error">${(flash.invalidMessage!)}</h5>
					<textarea rows="10" cols="10" id="description" name="description" class="form-control" 
					placeholder="${i18n('project.description.placeholder')}"></textarea>
				</div>
				<div class="contact-form">
					<button id="submitForm" class="btn btn-success">${(i18n('button.save'))}</button>
				</div>
			</form>
			<a href="/project">View all projects</a>
		</div>
		<div class="col-lg-3">
			<#if flash.noFileSelected??>
				<p class="alert alert-danger">${(flash.noFileSelected)}</p>
			</#if>
			
			<p id="uploading" class="alert alert-info" hidden="true">${(i18n('uploading'))}</p>
			<form id="uploadForm" class="form-group form-error-label" action="/project/upload" method="post" enctype="multipart/form-data">
				<div class="contact-form">
					<label>${(i18n('select.image'))}</label>
					<input type="file" name="pictureName"/>
					<!-- <input type="file" name="pictureName"/>
					<input type="file" name="pictureName"/>
					<input type="file" name="pictureName"/> -->
				</div>			
				<div class="contact-form">
					<input type="submit" class="btn btn-success" value="${(i18n('button.upload'))}" onclick="send()"/>
				</div>
			</form>
		</div>
	</div>	
</@layout.myLayout>
	<script>
	$().ready(function() {
		$("#uploadForm").validate({
			rules:{
				pictureName: "required",
				pictureName: {
					required: true,
				}
			},
			messages: {
				pictureName: {
					required: "Please select picture"
				}
			}
		});
		// validate form on keyup and submit
		$("#projectForm").validate({
			rules: {
				title: "required",
				description: "required",
				title: {
					required: true,
					minlength: 15
				},
				description: {
					required: true,
					minlength: 20
				}
			},
			messages: {
				title: {
					required: "Please enter project title",
					minlength: "Title must be at least 20 characters"
				},
				description: {
					required: "Please enter description",
					minlength: "Description must be at least 30 characters long"
				}
			},
			submitHandler: function(form) {
				$.confirm({
					title: 'Confirm!',
				    confirmButtonClass: 'btn-success',
				    cancelButtonClass: 'btn-danger',
				    confirm: function(){
				       form.submit();
				    },
				    cancel: function(){
				    }
				});
			}
		});
	});
	function send(){
	    	$("#uploadForm").ajaxForm(function(){
	    		beforeSubmit: uploadingMessage();
	    		success: showResponse
	    		clearForm: true;
	    	});
	}
	function uploadingMessage(){
			document.getElementById("uploading").style.display='block';
	}
	function showResponse(responseText, statusText, xhr, $form)  { 
	    // for normal html responses, the first argument to the success callback 
	    // is the XMLHttpRequest object's responseText property 
	 
	    // if the ajaxForm method was passed an Options Object with the dataType 
	    // property set to 'xml' then the first argument to the success callback 
	    // is the XMLHttpRequest object's responseXML property 
	 
	    // if the ajaxForm method was passed an Options Object with the dataType 
	    // property set to 'json' then the first argument to the success callback 
	    // is the json data object returned by the server 
	 
	    alert('status: ' + statusText + '\n\nresponseText: \n' + responseText + 
	        '\n\nThe output div should have already been updated with the responseText.'); 
	} 
    </script>